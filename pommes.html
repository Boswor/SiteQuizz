<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Pommes meter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/konami@1.7.0/konami.js"></script>
    <link rel="stylesheet" type="text/css" href="https://csshake.surge.sh/csshake.min.css">
    <script type="importmap">
    {
        "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.161/build/three.module.js"
        }
    }
    </script>
    <style>
        * {
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
        }


        html {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        body {
            width: 100%;
            height: 100%;
        }

        h1 {
            font-size: 22px;
            font-family: sans-serif;
            text-align: center;
            margin-bottom: 5px;
        }

        .thermometer {
            width: 240px;
            margin: 0;
            position: relative;
            transform: scale(1.8);
            bottom: 110px;
            left: 100px;
        }

        .thermometer-base,
        .thermometer-body {
            background-color: #ededfa;
            border: 15px solid #d8d9e8;
            margin: 0 auto;
        }

        .thermometer-base,
        .thermometer-base-fill {
            margin: 0 auto;
            border-radius: 50%;
            z-index: 0;
        }

        .thermometer-base {
            height: 120px;
            width: 120px;
            position: relative;
            z-index: 10;
        }

        .thermometer-base::before {
            content: "";
            background-color: #ccc;
            height: 36px;
            width: 40px;
            position: absolute;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
            top: 0;
            z-index: 10;
        }

        .thermometer-base::after {
            content: "";
            background-color: #fff;
            height: 20px;
            width: 20px;
            position: absolute;
            right: 12px;
            top: 15px;
            z-index: 10;
            border-radius: 100%;
        }

        .thermometer-base-fill {
            background-color: #ccc;
            height: 93px;
            width: 93px;
            position: relative;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .thermometer-body,
        .thermometer-body-fill {
            margin: 0 auto;
            border-radius: 50px 50px 0 0;
            z-index: 1;
        }

        .thermometer-body {
            height: 325px;
            width: 70px;
            border-bottom: 0;
            position: relative;
            bottom: -23px;
        }

        .thermometer-body-fill {
            background-color: #ccc;
            height: 16px;
            width: 40px;
            position: absolute;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            transition: background-color 0.3s ease-in-out, height 1s linear(0, 0.004, 0.016, 0.035, 0.063, 0.098, 0.141 13.6%, 0.25, 0.391, 0.563, 0.765,
                    1, 0.891 40.9%, 0.848, 0.813, 0.785, 0.766, 0.754, 0.75, 0.754, 0.766, 0.785,
                    0.813, 0.848, 0.891 68.2%, 1 72.7%, 0.973, 0.953, 0.941, 0.938, 0.941, 0.953,
                    0.973, 1, 0.988, 0.984, 0.988, 1) !important
                /* ^^ */
            ;
        }

        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
        }

        .btn {
            color: #2d2930;
            background-color: #dbdbdb;
            padding: 5px;
            height: 100px;
            width: 100px;
            border-radius: 50%;
            border: none;
            filter: drop-shadow(3px 3px 4px #333333);
            box-shadow: inset 3px 3px 5px #fff;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s linear, background-color 0.2s linear;
            font-size: 45px;
            text-align: center;
        }

        .btn:hover,
        .btn.active {
            transform: scale(1.15);
            background-color: white;
        }

        .very-hot-bg .btn.active {
            animation: rainbow-bg 0.8s linear;
            animation-iteration-count: infinite;
        }

        .thermometer-body-fill,
        .thermometer-base-fill,
        .thermometer-base::before {
            transition: background-color 0.3s ease-in-out;
        }

        .very-hot-bg .thermometer-body-fill,
        .very-hot-bg .thermometer-base-fill,
        .very-hot-bg .thermometer-base::before {
            animation: rainbow-bg 0.8s linear;
            animation-iteration-count: infinite;
        }

        .very-hot-bg #canvas {
            display: block;
        }

        .very-hot-bg .three-canvas {
            display: block !important;
        }

        .very-cold-bg .thermometer-body-fill,
        .very-cold-bg .thermometer-base-fill,
        .very-cold-bg .thermometer-base::before {
            background-color: #6495ed;
        }

        .cold-bg .thermometer-body-fill,
        .cold-bg .thermometer-base-fill,
        .cold-bg .thermometer-base::before {
            background-color: #800080;
        }

        .warm-bg .thermometer-body-fill,
        .warm-bg .thermometer-base-fill,
        .warm-bg .thermometer-base::before {
            background-color: #c40233;
        }

        .very-hot-bg {
            background: rgb(232, 154, 30);
            background: linear-gradient(0deg,
                    rgba(232, 154, 30, 1) 0%,
                    rgba(232, 141, 30, 1) 35%,
                    rgba(232, 50, 30, 1) 100%);
        }


        .warm-bg {
            background: rgb(30, 232, 52);
            background: linear-gradient(0deg,
                    rgba(30, 232, 52, 1) 0%,
                    rgba(151, 232, 30, 1) 35%,
                    rgba(229, 232, 30, 1) 100%);
        }

        .cold-bg {
            background: rgb(30, 212, 232);
            background: linear-gradient(0deg,
                    rgba(30, 212, 232, 1) 0%,
                    rgba(30, 232, 130, 1) 35%,
                    rgba(30, 232, 52, 1) 100%);
        }

        .very-cold-bg {
            background: rgb(120, 30, 232);
            background: linear-gradient(0deg,
                    rgba(120, 30, 232, 1) 0%,
                    rgba(30, 127, 232, 1) 35%,
                    rgba(30, 212, 232, 1) 100%);
        }

        .feur-mdrr {
            display: flex;
            justify-content: flex-start;
            align-items: flex-end;
            gap: 200px;
            width: 100%;
            height: 100%;
            padding-bottom: 150px;
        }

        .yes {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            top: 45px;
        }

        .results {
            position: relative;
            height: 100%;
            margin-top: 80px;
        }

        .photo-result {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .photo {
            height: 400px;
        }

        .title {
            text-align: center;
            max-width: 750px;
            color: white;
            height: 150px;
        }

        .title span {
            font-size: 60px;
        }

        .title .subtitle {
            font-size: 30px;
            color: white;
        }


        .photo-result--very-hot {
            transition: unset;
            z-index: 1;
        }

        .very-hot-bg .photo-result--very-hot {
            opacity: 1;
        }

        .very-cold-bg .photo-result--very-cold {
            opacity: 1;
        }

        .warm-bg .photo-result--warm {
            opacity: 1;
        }

        .cold-bg .photo-result--cold {
            opacity: 1;
        }

        h1 {
            color: magenta;
            font-size: 83px;
            position: absolute;
            z-index: 10;
            top: -40px;
            font-family: 'Times New Roman', Times, serif;
        }

        @keyframes rainbow-bg {

            100%,
            0% {
                background-color: rgb(255, 0, 0);
            }

            8% {
                background-color: rgb(255, 127, 0);
            }

            16% {
                background-color: rgb(255, 255, 0);
            }

            25% {
                background-color: rgb(127, 255, 0);
            }

            33% {
                background-color: rgb(0, 255, 0);
            }

            41% {
                background-color: rgb(0, 255, 127);
            }

            50% {
                background-color: rgb(0, 255, 255);
            }

            58% {
                background-color: rgb(0, 127, 255);
            }

            66% {
                background-color: rgb(0, 0, 255);
            }

            75% {
                background-color: rgb(127, 0, 255);
            }

            83% {
                background-color: rgb(255, 0, 255);
            }

            91% {
                background-color: rgb(255, 0, 127);
            }
        }

        #canvas {
            z-index: 1;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            display: none;
        }

        .three-canvas {
            z-index: -1;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            display: none !important;
        }
    </style>
    <script src="ParticleSystem.js"></script>
    <script src="SpriteParticle.js"></script>
    <script src="Spawner.js"></script>
</head>

<body class="very-cold-bg">
    <canvas id="canvas"></canvas>

    <h1>Combien de pommes pouvez-vous manger √† la suite si vous avez le ventre vide ?</h1>
    <div class="feur-mdrr">
        <div class="thermometer">
            <div class="thermometer-body">
                <div class="thermometer-body-fill"></div>
            </div>
            <div class="thermometer-base">
                <div class="thermometer-base-fill"></div>
            </div>

        </div>

        <div class="yes">
            <div class="results">
                <div class="photo-result photo-result--very-cold">
                    <img class="photo" src="assets/aaa.gif">
                    <div class="title">
                        <span>0</span>
                        <div class="subtitle">
                            J'esp√®re que tu as une bonne excuse......
                        </div>
                    </div>
                </div>

                <div class="photo-result photo-result--cold">
                    <img class="photo" src="assets/bren.png">
                    <div class="title">
                        <span>1</span>
                        <div class="subtitle">
                            Eh oui apr√®s la premi√®re tu n'auras plus le vendre vide, malin ! üß† (mais c'est pas un
                            mindset de winner √ßa)
                        </div>
                    </div>
                </div>

                <div class="photo-result photo-result--warm">
                    <img class="photo" src="assets/enjoyer.png">
                    <div class="title">
                        <span>4 ou 5</span>
                        <div class="subtitle">
                            Average apple enjoyer
                        </div>
                    </div>
                </div>

                <div class="photo-result photo-result--very-hot">
                    <img class="photo" src="assets/beem.png">
                    <div class="title">
                        <span>PLUS DE 99 !!!!!!!</span>
                        <div class="subtitle">
                            PARCE QUE TU ES JUSTE TROP LE GOAT !!!1!!!!!!
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button id="very-cold" class="active btn very-cold" aria-label="Set temperature to very cold">
                    ‚ô®Ô∏è
                </button>

                <button id="cold" class="btn cold" aria-label="Set temperature to cold">
                    üìÅ
                </button>

                <button id="warm" class="btn warm" aria-label="Set temperature to warm">
                    üóúÔ∏è
                </button>

                <button id="very-hot" class="btn very-hot" aria-label="Set temperature to very hot">
                    üçâ
                </button>

            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const FILL_HEIGHT = {
                "very-hot": "1000px",
                warm: "210px",
                cold: "60px",
                "very-cold": "16px"
            };

            let tempFill = document.querySelector(".thermometer-body-fill");
            let controls = document.querySelector(".controls");
            let container = document.querySelector(".feur-mdrr");

            controls.addEventListener("click", (event) => {
                if (event.target.nodeName === "BUTTON") {
                    document.body.className = `${event.target.id}-bg`;
                    tempFill.style.setProperty("height", FILL_HEIGHT[event.target.id]);
                    document.querySelectorAll("button").forEach(b => {
                        b.classList.remove("active");
                    })
                    event.target.classList.add("active");
                    if (event.target.id == "very-hot") {
                        container.classList.add("shake-hard");
                    } else {
                        container.classList.remove("shake-hard");

                    }
                }
            });

            /*
            ==============================
                CANVAS SETUP
            ================================
            */
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");

            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            window.addEventListener("resize", resize);
            resize();


            /*
            ==============================
                CONFIG PROJET
            ================================
            */
            const CONFIG = {
                spritesheet: {
                    src: "assets/kaboom_strip17.png",
                    frameWidth: 142,
                    frameHeight: 200,
                    frameCount: 17,
                    frameSpeed: 2,
                    loop: false
                },

                spawn: {
                    rate: 30,
                    size: () => Math.random() * 120 + 80,
                    x: () => Math.random() * canvas.width,
                    y: () => Math.random() * canvas.height,
                    angle: () => 0,
                    speed: () => 0,
                    life: () => (CONFIG.frameCount + 1) * CONFIG.frameSpeed
                }
            };


            /*
            ==============================
               LOAD SPRITESHEET
            ================================
            */
            const image = new Image();
            image.src = CONFIG.spritesheet.src;

            image.onload = () => {
                const system = new ParticleSystem(ctx);

                const spawner = new Spawner(
                    system,
                    () => new SpriteParticle({
                        image,
                        x: CONFIG.spawn.x(),
                        y: CONFIG.spawn.y(),
                        angle: CONFIG.spawn.angle(),
                        speed: CONFIG.spawn.speed(),
                        baseWidth: CONFIG.spawn.size(),
                        life: CONFIG.spawn.life(),

                        frameWidth: CONFIG.spritesheet.frameWidth,
                        frameHeight: CONFIG.spritesheet.frameHeight,
                        frameCount: CONFIG.spritesheet.frameCount,
                        frameSpeed: CONFIG.spritesheet.frameSpeed,
                        loop: CONFIG.spritesheet.loop
                    }),
                    CONFIG.spawn.rate
                );

                function loop() {
                    spawner.update();
                    system.update();
                    system.draw();
                    requestAnimationFrame(loop);
                }


                loop();
            };
        });
    </script>


    <script>
        const easterEgg = new Konami(atob("aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj0wSDlyTHlnQUNoTQ=="));
    </script>

    <script type="module">
        import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.161/build/three.module.js";
        import { GLTFLoader } from "https://cdn.jsdelivr.net/npm/three@0.161/examples/jsm/loaders/GLTFLoader.js";
        import { DRACOLoader } from "https://cdn.jsdelivr.net/npm/three@0.161/examples/jsm/loaders/DRACOLoader.js";
        import * as CANNON from "https://cdn.jsdelivr.net/npm/cannon-es@0.20.0/dist/cannon-es.js";

        // ===== Scene =====
        const scene = new THREE.Scene();

        scene.background = null;

        // Cam√©ra fixe
        const camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 7, 16);
        camera.lookAt(0, 2, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        renderer.domElement.classList.add("three-canvas");

        // ===== Lights =====
        const hemi = new THREE.HemisphereLight(0xffffff, 0x1e293b, 1.3);
        scene.add(hemi);
        const keyLight = new THREE.DirectionalLight(0xfff2e5, 2.8);
        keyLight.position.set(6, 12, 8);
        scene.add(keyLight);
        const fillLight = new THREE.DirectionalLight(0xdbeafe, 1.6);
        fillLight.position.set(-6, 6, 4);
        scene.add(fillLight);
        const rimLight = new THREE.DirectionalLight(0xffffff, 2.0);
        rimLight.position.set(0, 10, -8);
        scene.add(rimLight);

        // ===== Physics =====
        const world = new CANNON.World();
        world.gravity.set(0, -2.5, 0);
        const applePhysMat = new CANNON.Material("apple");
        const groundPhysMat = new CANNON.Material("ground");
        const contactMat = new CANNON.ContactMaterial(applePhysMat, groundPhysMat, { friction: 0.2, restitution: 0.85 });
        world.addContactMaterial(contactMat);
        const groundBody = new CANNON.Body({ mass: 0, material: groundPhysMat });
        const groundShape = new CANNON.Plane();
        groundBody.addShape(groundShape);
        groundBody.quaternion.setFromEuler(-Math.PI / 2, 0, 0);
        world.addBody(groundBody);
        const groundMesh = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({ color: 0x000000, transparent: true, opacity: 0 }));
        groundMesh.position.y = -2;
        groundMesh.rotation.x = -Math.PI / 2;
        scene.add(groundMesh);

        // ===== Load Apple Model =====
        const MODEL_PATH = "./assets/3d/apple.glb";
        const loader = new GLTFLoader();
        const draco = new DRACOLoader();
        draco.setDecoderPath("https://cdn.jsdelivr.net/npm/three@0.161/examples/jsm/libs/draco/");
        loader.setDRACOLoader(draco);
        let appleModel = null;
        loader.load(MODEL_PATH, (gltf) => { appleModel = gltf.scene });

        // ===== Apples =====
        const apples = [];
        function createApple() {
            if (!appleModel) return;
            const mesh = appleModel.clone(true);
            const scale = 0.8 + Math.random() * 0.4;
            mesh.scale.setScalar(scale);
            const biasX = (Math.random() * 0.5 - 0.25);
            const biasZ = -Math.random() * 4.5;
            mesh.position.set((Math.random() - 0.5) * 8 + biasX, 10 + Math.random() * 6, (Math.random() - 0.5) * 8 + biasZ);
            scene.add(mesh);
            const radius = 0.35 * scale;
            const shape = new CANNON.Sphere(radius);
            const body = new CANNON.Body({ mass: 1, shape, material: applePhysMat, position: new CANNON.Vec3(mesh.position.x, mesh.position.y, mesh.position.z), angularDamping: 0.2 });
            body.angularVelocity.set((Math.random() - 0.5) * 8, (Math.random() - 0.5) * 8, (Math.random() - 0.5) * 8);
            world.addBody(body);
            apples.push({ mesh, body });
        }
        setInterval(() => { if (apples.length < 300) createApple(); }, 50);

        // ===== Animate =====
        const clock = new THREE.Clock();
        function animate() {

            requestAnimationFrame(animate);

            if (!document.body.classList.contains('very-hot-bg')) return;

            const dt = Math.min(clock.getDelta(), 0.033);
            world.step(1 / 60, dt, 3);
            for (const a of apples) {
                a.mesh.position.copy(a.body.position);
                a.mesh.quaternion.copy(a.body.quaternion);
            }
            renderer.render(scene, camera); // plus de postprocessing pour garder les pommes nettes
        }
        animate();

        window.addEventListener("resize", () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

        // Canvas pour gradient
        const canvas = document.createElement('canvas');
        canvas.width = 1;
        canvas.height = 256;
        const ctx = canvas.getContext('2d');

        // Gradient vertical
        const grad = ctx.createLinearGradient(0, 0, 0, 256);
        grad.addColorStop(0, 'rgb(232,154,30)');
        grad.addColorStop(0.35, 'rgb(232,141,30)');
        grad.addColorStop(1, 'rgb(232,50,30)');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, 1, 256);

        // Texture Three.js
        const texture = new THREE.CanvasTexture(canvas);
        texture.magFilter = THREE.LinearFilter;
        texture.minFilter = THREE.LinearFilter;

        // Plane large derri√®re la sc√®ne
        const bgPlane = new THREE.Mesh(
            new THREE.PlaneGeometry(1500, 1050),
            new THREE.MeshBasicMaterial({ map: texture, depthWrite: false })
        );
        bgPlane.position.z = -500;
        scene.add(bgPlane);


    </script>
</body>

</html>