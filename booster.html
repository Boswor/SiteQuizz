<!DOCTYPE html>
<html lang="fr">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0">
	<title>Ouverture de Booster</title>
	<script src="https://unpkg.com/konami@1.7.0/konami.js"></script>
	<style>
		body {
			margin: 0;
			height: 100vh;
			display: flex;
			justify-content: center;
			align-items: center;
			background: radial-gradient(circle at top, #383841, #141418);
			overflow: hidden;
			font-family: sans-serif;
		}

		#booster {
			position: relative;
			width: 300px;
			cursor: pointer;
			perspective: 800px;
			transition: transform 0.8s ease, opacity 0.8s ease;
		}

		#booster img {
			width: 100%;
			display: block;
		}

		#tear {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 22px;
			background: url('./assets/booster-top.png') center/cover no-repeat;
			transform-origin: top center;
			transform: rotateX(0deg);
			transition: transform 0.6s ease;
			z-index: 2;
			pointer-events: none;
		}

		.opened #tear {
			transform: translateY(-180px) rotate(-12deg) scale(1.05);
		}

		.opened {
			transform: translateY(120px) scale(0.9);
			opacity: 0;
		}

		/* --- CARTES --- */
		#cards {
			position: absolute;
			display: none;
			width: 300px;
			height: 375px;
			cursor: pointer;
		}

		.card {
			position: absolute;
			width: 100%;
			top: 0;
			left: 0;
			transform: translateY(40px) scale(0.96) rotate(0deg);
			opacity: 0;
			transition: transform 0.5s ease, opacity 0.5s ease;
		}

		.card.visible {
			transform: translateY(0) scale(1) rotate(1.5deg);
			opacity: 1;
		}

		.card.visible:nth-child(4n) {
			transform: translateY(0) scale(1) rotate(2deg);
			opacity: 1;
		}

		.card.visible:nth-child(4n-1) {
			transform: translateY(0) scale(1) rotate(-1.5deg);
			opacity: 1;
		}

		.card.visible:nth-child(4n-2) {
			transform: translateY(0) scale(1) rotate(1deg);
			opacity: 1;
		}

		.card.visible:nth-child(4n-3) {
			transform: translateY(0) scale(1) rotate(-2.5deg);
			opacity: 1;
		}

		button {
			position: absolute;

			top: 10px;
			left: 10px;

			background: red;
			color: yellowgreen;
		}

		#canvas {
			z-index: -1;
			position: fixed;
			top: 0;
			left: 0;
			width: 100vw;
			height: 100vh;
		}
	</style>
</head>

<body>
	<script src="ParticleSystem.js"></script>
	<script src="SpriteParticle.js"></script>
	<script src="Spawner.js"></script>

	<canvas id="canvas"></canvas>

	<div id="booster">
		<img src="./assets/booster.png" alt="Booster" />
		<div id="tear"></div>
	</div>

	<button onclick="window.location.reload();">CLIQUER POUR ROFAIRE</button>

	<div id="cards">
		<img class="card" src="./assets/cards/card1.png" />
		<img class="card" src="./assets/cards/card2.png" />
		<img class="card" src="./assets/cards/card3.png" />
		<img class="card" src="./assets/cards/card4.png" />
		<img class="card" src="./assets/cards/card5.png" />
		<img class="card" src="./assets/cards/card6.png" />
		<img class="card" src="./assets/cards/card7.png" />
	</div>

	<script>



		const booster = document.getElementById('booster');
		const cardsContainer = document.getElementById('cards');
		const cards = Array.from(document.querySelectorAll('.card'));
		let cardIndex = 0;

		cardsContainer.addEventListener('click', () => {
			if (cardIndex < cards.length) {
				const card = cards[cardIndex];
				card.classList.add('visible');
				card.style.zIndex = cardIndex + 1;
				cardIndex++;
			}
		});

		booster.addEventListener('click', () => {
			booster.classList.add('opened');

			setTimeout(() => {
				booster.style.display = 'none';
				cardsContainer.style.display = 'block';
				setTimeout(() => {
					cardsContainer.dispatchEvent(new Event("click"));
				}, 100)
			}, 700);
		});



	</script>

	<script>
		document.addEventListener('DOMContentLoaded', () => {
			/*
			==============================
				CANVAS SETUP
			================================
			*/
			const canvas = document.getElementById("canvas");
			const ctx = canvas.getContext("2d");

			function resize() {
				canvas.width = window.innerWidth;
				canvas.height = window.innerHeight;
			}
			window.addEventListener("resize", resize);
			resize();


			/*
			==============================
				CONFIG PROJET
			================================
			*/
			const CONFIG = {
				spritesheet: {
					src: "assets/furret_strip10.png",
					frameWidth: 357,
					frameHeight: 205,
					frameCount: 10,
					frameSpeed: 3,
					loop: true
				},

				spawn: {
					rate: 5,
					size: () => Math.random() * 120 + 40,
					x: () => canvas.width + 160,
					y: () => Math.random() * canvas.height,
					angle: () => Math.PI,
					speed: () => Math.random() * 2 + 1,
					life: () => 2000
				}
			};


			/*
			==============================
			   LOAD SPRITESHEET
			================================
			*/
			const image = new Image();
			image.src = CONFIG.spritesheet.src;

			image.onload = () => {
				const system = new ParticleSystem(ctx);

				const spawner = new Spawner(
					system,
					() => new SpriteParticle({
						image,
						x: CONFIG.spawn.x(),
						y: CONFIG.spawn.y(),
						angle: CONFIG.spawn.angle(),
						speed: CONFIG.spawn.speed(),
						baseWidth: CONFIG.spawn.size(),
						life: CONFIG.spawn.life(),

						frameWidth: CONFIG.spritesheet.frameWidth,
						frameHeight: CONFIG.spritesheet.frameHeight,
						frameCount: CONFIG.spritesheet.frameCount,
						frameSpeed: CONFIG.spritesheet.frameSpeed,
						loop: CONFIG.spritesheet.loop
					}),
					CONFIG.spawn.rate
				);

				function loop() {
					spawner.update();
					system.update();
					system.draw();
					requestAnimationFrame(loop);
				}


				loop();
			};
		});
	</script>

	<script>
		const easterEgg = new Konami(atob("aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1mSXA0VlBKX19NWSZ0PTE0cw=="))
	</script>
</body>

</html>